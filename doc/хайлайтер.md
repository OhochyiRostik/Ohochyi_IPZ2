# Зміст
1. [Вступ](#вступ)
2. [Завдання](#завдання)
3. [Основні положення](#положення)
4. [Проектування](#проектування)
5. [Розробка](#розробка)
6. [Тестування](#тестування)
7. [Висновки](#висновки)
8. [Джерела](#джерела)

<a name="вступ"></a>
## Вступ

**Мета:**

Даний документ ставить перед собою мету показати процес створення власного хайлайтера для обраної мови, а саме Data Processing Script, на базі бібліотеки highlight.js.

Data Processing Script - це спеціалізована мова, яка дозволяє описати послідовність дій, пов'язаних з обробкою даних в сервісі обробки, переклавши навантаження по реалізації рутинних обчислень на серверну сторону.

Скрипт являє собою безумовну послідовність команд, які виконуються на неявному контексті скрипта (результати попередніх команд - це контекст, з якого вибираються аргументи наступної команди).

У DPS можна використовувати ін'єкції html, text, xml, csv, json, які перетворюються в відповідні js-типи і об'єкти.

Highlight.js - хайлайтер, написаний на JavaScript, працює як у браузері, так і на сервері, може працювати практично з будь-якою розміткою, не залежить від будь-яких інших фреймворків і має автоматичне визначення мови.

**Переваги підсвічування синтаксису:**

Основною первагою підсвічування синтаксису є полегшення розпізнавання синтаксису і структури коду програмістом, це підтверджує дослідження, опубліковане на конференції PPIG, яке оцінило вплив виділення синтаксису на розуміння коротких програм, виявивши, що наявність підсвічування синтаксису значно скорочує час, необхідний програмісту для узагальнення семантики програми. Окрім того, дані, зібрані під час дослідження, що відстежували очі, свідчать про те, що підсвічування синтаксису дозволяє програмістам приділяти менше уваги стандартним синтаксичним компонентам, таким як ключові слова.

До плюсів хайлайтера можна також віднести той факт, що він допомагає зменшити кількість орфографічнох помилок або ж помилок друку в коді, наприклад неправильне написання ключових слів і т.д.



<a name="завдання"></a>
## Завдання
**Загальне завдання:**

Розробити модуль підсвітки синтаксису DPS з використанням бібліотеки highlight.js.

**Функціональність:**

Користувач повинен мати можливість використовувати хайлайтер на власній машині та веб-сторінці.

<a name="положення"></a>
## Основні положення
Задача хайлатера виділення певним чином (зазвичай кольором), певних елементів тексту (лексем), для покращення сприйняття його вмісту. Зазвичай застосовується до кодів програм, та розмітки документів. Розмітка синтаксису підтримується багатьма текстовими редакторами, та деякими сайтами, що публікують код.

Підсвітка синтаксису — виділення певним чином, певних елементів тексту, для покращення сприйняття його вмісту. Зазвичай застосовується до кодів програм, та розмітки документів. Розмітка синтаксису підтримується багатьма текстовими редакторами, та деякими сайтами, що публікують код.

<a name="проектування"></a>
## Проектування

**Сценарій підсвітки тексту типу string**

| Ідентифікатор: | STRING |
| --- | --- |
| Назва: | Підсвітка тексту типу string |
| Учасники: | Користувач; Система |
| Передумови: | Користувач використав елементи виділенні лапками ' ' |
| Результат: | Користувач отримує певну підсвітку синтаксису |
| Виключні ситуації: | Текст є частиною іншого класу, наприклад - заголовку або ж коментару |
| Основний сценарій: | 1. Користувач використовує текст виділений лапками.<br>2. Система ідентифікує даний текст окремим класом.<br>3. Система підсвічує даний текст певним кольором.<br>4. Користувач отримує певну підсвітку синтаксису.|

**Сценарій підсвітки коментарів**

| Ідентифікатор: | COMMENT |
| --- | --- |
| Назва: | Підсвітка коментарів. |
| Участники: | Користувач; Система |
| Передумови: | Користувач використав елементи виділенні данним чином: /' '/ |
| Результат: | Користувач отримує певну підсвітку синтаксису |
| Основний сценарій: |  1. Користувач вписав текст усередині /' '/.<br>2. Система ідентифікує даний текст окремим класом.<br>3. Система підсвічує даний текст певним кольором.<br>4. Користувач отримує певну підсвітку синтаксису.|

**Сценарій підсвітки границь коду**

| Ідентифікатор: | SYMBOL |
| --- | --- |
| Назва: | Підсвітка границь коду. |
| Участники: | Користувач; Система |
| Передумови: | Користувач використав '@startuml' або ж '@enduml' |
| Результат: | Користувач отримує певну підсвітку синтаксису |
| Основний сценарій: |  1. Користувач використав @startuml або ж @enduml.<br>2. Система ідентифікує даний текст окремим класом.<br>3. Система підсвічує даний текст певним кольором.<br>4. Користувач отримує певну підсвітку синтаксису.|

**Сценарій підсвітки назви заголовку**

| Ідентифікатор: | TITLE |
| --- | --- |
| Назва: | Підсвітка заголовку. |
| Участники: | Користувач; Система |
| Передумови: | Користувач використав 'title' |
| Результат: | Користувач отримує певну підсвітку синтаксису |
| Виключні ситуації: | title знаходиться в середині коментаря, або ж є 'string' класом |
| Основний сценарій: |  1. Користувач використав 'title'.<br>2. Система ідентифікує даний текст окремим класом.<br>3. Система підсвічує даний текст певним кольором.<br>4. Користувач отримує певну підсвітку синтаксису.|



<a name="розробка"></a>
## Розробка

Розробка і подальше написання власного хайлайтера починається з розуміння структури та базового синтаксису мови програмування для якої власне і створюється хайлайтер.
Для початку потрібно розуміти, що будь-яка мова програмування, для якої ви будете створювати хайлайтер, складається з багатьох умовних частин. Такими частинами у більшості мов програмування виступають: 
	* ключові слова
	* коментарі
	* функції (процедури)
	* символи
	* класи та типи об'єктів та безліч інших складових коду
Ключовою особливістю саме DPS є інєкції html, text, xml, csv, json, що значною мірою підвищує складність завдання

Але варто пам'ятати, що ті ж самі знайомі нам ключові слова `for` та `if`  не мають сенсу всередині рядкових форматів, які у свою чергу можуть містити зворотню косу риску `\`, що у багатьох мовах програмування вважається початком коментару, а коментарі зазвичай не містять нічого цікавого, окрім закінчення самого ж коментару.

У Highlight.js такі частини називаються "режимами".

Кожен режим підсвітки може складатися з:
	* умови початку
	* умови закінчення
	* списку вміщених підрежимів
	* правил, регулярних виразів та ключових слів
	* інколи може містити деяку мову всередині іншої мови

Надалі розглядатимемо загальну структуру хайлайтеру highlight.js та її найважливіші складові:
```javascript
{
  case_insensitive: true, // чутливість до регістру
  keywords: 'for if while',
  contains: [
    {
      className: 'string',
      begin: '"', end: '"'
    },
    hljs.COMMENT(
      '/\\*', // умова початку
      '\\*/', // умова кінця
      {
        contains: [
          {
            className: 'doc', begin: '@\\w+'
          }
        ]
      }
    )
  ]
}
```
### Ключові слова (Keywords)

У загальному випадку ключове слово – це засіб мови програмування, який:
	* вбудований в мову програмування
	* використовується для розробки програми на цій мові
Кожна з мов програмування має як спільні з іншими мовами, так і власні `keywords`. 

Водночас, деякі мови мають різні типи "ключових слів", які з огляду синтаксичного аналізу хоч і не є однаковими, але є дуже близькими один до одного з точки зору підсвічування синтаксису. Це всілякі `literals`, `built-in`, `symbols` тощо. Щоб визначити такі групи ключових слів, ключові слова атрибутів стають об’єктом, кожна властивість якого визначає власну групу ключових слів:
```javascript
{
  keywords: {
    keyword: 'else for if while', //Перший спосіб задання списку ключових слів - перелік у лапках через пробіл 
    literal: ['false','true','null'], //Другий спосіб - масивом.
    _relevance_only: 'one two three four'
  }
}
```

### Генерація підсвітки

Важливо розуміти, що яким кольором буде підсвічуватись текст, назви класів та їх графічні складові визначає `css` стиль, а не модуль підсвічування тексту для бібліотеки highlight.js, який ми створюємо. У цьому проекті не розглядається його створення, а для візуального тестування використовується вже існуючий - `monokai`. Плід наших зусиль являє собою деяку "підсказку", "вказування шляху та границь підсвічування", а не задання палітри підсвітки. 

Режими хайлайтеру зазвичай генерують фактичну розмітку виділення - елементи `<span>` з певними іменами класів, які визначаються атрибутом `className`:
```javascript
{
className:"symbol",
begin: /\@startuml|\@enduml/,
end: "\n"
}
```

Надзвичайно важливим, я б навіть сказав життєво-необхідним у нашій роботі є знання регулярних виразів, їх розуміння та вміння вільно ними користуватися. Саме регулярними виразами ми будемо задавати умови початку та кінця підсвічування синтаксису.
Чудовими сайтами для їх вивчення та тренування відповідно є: [MND Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions) та [Regexr](https://regexr.com/)

Давайте розглянемо регулярні вирази у наведеному вище прикладі:
Завдання данного класу - виділення "@startuml" і "@enduml" унікальним чином. Така необхідність з'являється, оскільки жодна програма мовою `plantuml` не може обійтись без них, та саме вони є границями нашої програми.
 `/\@startuml|\@enduml/` - умова початку. Задаючи умову початку у передніх косих рисах, ми говоримо, що весь синтаксис всередині умови має йти поспіль. Елемент `@` потрібно попередньо екранувати за допомогою бекслешу, бо інакше цей елемент не буде вважатись одним цілим з словами, що слідують за ним. Вертикальна ж риса `|` позначатиме логічну дію 'OR', тобто 'або'. 
 Умовою кінця виступає новий рядок, що позначається спецсимволом `\n`.

 Перекладаючи на людську мову, дана частина коду звучить як: "Якщо текст починається з '@startuml' або ж '@enduml', та закінчується новим рядком, то присвоїти тексту клас 'symbol'(і відповідну задану в css цьому класу підсвітку)."  

<a name="тестування"></a>
## Тестування
<a name="висновки"></a>
## Висновки
Провівши аналіз предметної області, порівнявши переваги та недоліки вже існуючих систем підсвічування синтаксису, враховуючи навчальну направленість проекту, було прийнято рішення створити власний хайлайтер для обраної мови plantuml на базі бібліотеки highlight.js.
<a name="джерела"></a>
## Джерела
